{% extends "_api_base.html" %}

{% block script %}
<script type="text/javascript" src="/static/js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="/static/js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="text/javascript">

    var form_key = '{{form.key}}';
    
    $(function() {
            $( "#accordion" ).accordion();
        });
</script>
        {% ifequal form.status 'draft' %}
            <script type="text/javascript">
                function send_request(){
                    if (flag){
                        $.get('/lock_form/' + form_key, function(data){
                        if (data != 'ok'){
                            $('#hint').html(data);
                        }
                        else{
                            message = "form is unlocked";
                            load(document.location.hash.replace('#',''));
                            }
                        })}

                }
                function lock_form(){
                    setInterval('send_request()', 30000);}
                 $(document).ready(function(){
                    lock_form();
                    send_request();
    });
        $(document).ready(function(){
            flag = true;
        })
            </script>
        {% endifequal %}
{% endblock %}

{% block breadcrumps %}
<a href="/#/manager/home">Home</a> > <a href="/#/manager/get/all">PR</a> >
<a href="/#/manager/get/{{form.pr.employee.dept.name}}">{{form.pr.employee.dept.name}}</a> >
<a>{{form.pr.employee.first_name}}&nbsp;{{form.pr.employee.last_name}}&nbsp;form</a>
{% endblock %}

{% block content %}
<div id="info">
<p>Performance Review Form for {{form.pr.employee.first_name}} {{form.pr.employee.last_name}}</p>
<p>date: {{form.pr.date}}</p>
</div>

<div id='accordion'>
<h3><a href="#">Projects and Initiatives</a></h3>
    <div>
        <div id="project">
        <p>Please list all projects and initiatives you participated in during this performance review period.</p>
        <ul>
        {% for project in form.projects %}
            <li id="{{project.key}}">{{project.value}}</li>
        {% endfor %}
        </ul>
    
</div>
    </div>
<h3><a href="#">Achievements and Challenges</a></h3>
    <div>
        <div id="prev_achievements">
            <<a href="#" onclick="display(this); return false">Show previous achievements</a>
            <div class='hidden'>
                <ul>
                {% for achievement in prev_form.achievements %}
                    <li>{{achievement.value}}</li>
                {% endfor %}
                </ul>
            </div>
        </div>

        <div id="achievements" class="input_div">
            <p>What do you consider to be your key accomplishments since your last review?</p>
            <ul>
            {% for ach in form.achievements %}
                <li id="{{ach.key}}">{{ach.value}}</li>
            {% endfor %}
            </ul>
            
        </div>

        <div id="prev_responsibilities">
            <a href="#" onclick="display(this); return false">Show previous responsibilities</a>
            <div class='hidden'>
                <ul>
                {% for responsibility in prev_form.responsibilities %}
                    <li>{{responsibility.value}}</li>
                {% endfor %}
                </ul>
            </div>
        </div>

        <div id="responsibility" class="input_div">
            <p>List your key job responsibilities during your performance period. Please comment on your job performance assessment.</p>
            <ul>
            {% for responsibility in form.responsibilities %}
                <li id="{{responsibility.key}}">{{responsibility.value}}</li>
            {% endfor %}
            </ul>
            
        </div>

        <div id="prev_challenges" >
            <a href="#" onclick="display(this); return false">Previous challenges</a>
            <div class='hidden'>
                <ul>
                {% for challenge in prev_form.challenges %}
                    <li>{{challenge.value}}</li>
                {% endfor %}
                </ul>
            </div>
        </div>


        <div id="challenges" class="input_div">
            <p>If you have experienced challenges, please specify the areas where you need to focus and improve. </p>
            <ul>
            {% for challenge in form.challenges %}
                <li id="{{challenge.key}}">{{challenge.value}}</li>
            {% endfor %}
            </ul>
            
        </div>
    </div>

    <h3><a href="#">Professional development plan</a></h3>
    <div>
        <div id="career" class="input_div">
            <p>To be filled in during the performance review session.
                The plan contains short term professional development activities.
            It can be split into self-development activities and trainings, courses or internship programs sponsored by the Company. </p>
            <ul>
            {% for career in form.careers %}
                <li id="{{career.key}}" >{{career.value}}</li>
            {% endfor %}
            </ul>
            
        </div>
    </div>
<h3><a href="#">Goals</a></h3>
    <div>
        <div id="prev_goals" class="prev_data">
            <p>Goals from the previous performance review and their evaluation.
                This section compares the goals and results achieved during the previous performance period.
                Actual examples of performance should be given whenever possible.</p>

            <table>
                <thead>
                    <tr>
                        <td>Goal</td>
                        <td>Value</td>
                    </tr>
                </thead>
            {% for prev_goal in prev_form.next_goals %}
                <tr>
                    <td>{{prev_goal.value}}</td>
                    <td>
                        <select id="{{prev_goal.key}}" onchange="set_result(this.id, this.options[selectedIndex].value)">
                            <option value="1" class="grade">below expectations</option>
                            <option value="2" class="grade">meet expectations</option>
                            <option value="3" class="grade">above expectations</option>
                        </select>
                        <script type="text/javascript" language="JavaScript">
                            $("#{{prev_goal.key}}").val("{{prev_goal.result}}");
                        </script>
                    </td>
                </tr>
            {% endfor %}
            </table>

        </div>

        <div id="next_goals" class="input_div">
            <p>Set measurable goals for the employee for the next performance review period.</p>
            <ul>
            {% for goal in form.next_goals %}
                <li id="{{goal.key}}" >{{goal.value}}</li>
            {% endfor %}
            </ul>
            
        </div>
    </div>
<h3><a href="#">Performance conclusion</a></h3>
    <div>
        {% block salary %}

        <div id='salary' class="input_div">
            New salary:
                <p class='text_field' onclick="make_input(this)" id="{{form.get_all_data.salary.key}}" >{{form.get_all_data.salary.value}}</p>

        </div>

        <div id='grade' class="input_div">
            Grade:
                <p class='text_field' onclick="make_input(this)" id="{{form.get_all_data.grade.key}}" >{{form.get_all_data.grade.value}}</p>
        </div>

        <div>
            New position:
                <p class='text_field' onclick="make_input(this)" id="{{form.get_all_data.position.key}}" >{{form.get_all_data.position.value}}</p>
        </div>
        {% endblock %}

        <div id='conclusion' class="prev_data">
            Conclusion:
                <select id="{{form.get_all_data.conclusion.key}}" onchange="send_value(this.id, this.options[selectedIndex].value)">
                    <option value="below expectations">below expectations</option>
                    <option value="meet expectations">meet expectations</option>
                    <option value="above expectations">above expectations</option>
                </select>
                <script type="text/javascript" language="JavaScript">
                            $("#{{form.get_all_data.conclusion.key}}").val("{{form.get_all_data.conclusion.value}}");
                </script>
        </div>
    </div>
<h3><a href="#">Misc</a></h3>
    <div>
        <div id="manager_comment" class="input_div">
            <p>Fill any comments on this particular form.</p>
            <ul>
            {% for manager_comment in form.manager_comments %}
                <li id="{{manager_comment.key}}" >{{manager_comment.value}}</li>
            {% endfor %}
            </ul>
            
        </div>
        {% block hr-comment %}
        {% endblock %}

        <div id="file">
            <p>Attached files:</p>
            {% if file_name%}
                <a href="/serve/{{file_key}}">{{file_name}}</a>
            {% endif %}
        </div>
 </div>
</div>
{% block buttons %}

{% ifequal user.email form.pr.manager.email  %}
    {% ifequal form.status 'submitted' %}
    <input type="button" value="undo submit" onclick="maf_draft('{{form.pr.employee.first_name}} {{form.pr.employee.last_name}}')">
    {% endifequal %}
    {% ifequal form.status 'approved' %}
    <input type="button" value="undo approve" onclick="register('{{form.pr.employee.first_name}} {{form.pr.employee.last_name}}')">
    {% endifequal %}
{% endifequal %}

{% endblock %}

{% endblock %}