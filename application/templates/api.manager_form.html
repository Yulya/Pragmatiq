{% extends "_api_base.html" %}

{% block script %}
<script type="text/javascript">

var form_key= '{{form.key}}';
var form_type='{{form.pr.period.type}}';


function approve(){
    $.get('/pr/manager/approve/' + form_key);
    $('input:text').attr('readonly', 'readonly');
    $('.add_button').attr('disabled', 'disabled');
}
function submit(){
            $.get('/pr/manager/submit/' + form_key, function(data){
            if (data == 'ok'){
                $('input:text').attr('readonly', 'readonly');
                $('.add_button').attr('disabled', 'disabled');
            }
            else{
                alert(data);
            }
            })
}

function check_form(){
    $.get('pr/manager/check/' + form_key, function(data){
        if (data){confirm('Unfilled fields: ' + data + '. Continue?');
                  approve();
                 }

    })
}

//
$(document).ready(function() {

    if ('{{form.status}}' == 'approved'){
        $('input:text').attr('readonly', 'readonly');
        $('.add_button').attr('disabled', 'disabled');
    }
    if ('{{form.status}}' == 'submitted'){
        $('.input_div').html('');
        $('#info').append('<p>form temporary unavailable</p>');
    }
    if ('{{form.status}}' == 'registered'){

        $('#{{data.salary.key}}').attr('readonly', 'readonly');
        $('#{{data.grade.key}}').attr('readonly', 'readonly');
    }
//
////    $('#approve').click(function(){
////        $.get('/pr/manager/approve/' + form_key);
////        $('input:text').attr('readonly', 'readonly');
////        $('.add_button').attr('disabled', 'disabled');
////    });
////
////    $('#submit').click(function(){
////        $.get('/pr/manager/submit/' + form_key, function(data){
////            if (data == 'ok'){
////                $('input:text').attr('readonly', 'readonly');
////                $('.add_button').attr('disabled', 'disabled');
////            }
////            else{
////                alert(data);
////            }
////        })
////        })
    })


</script>
{% endblock %}

{% block content %}
<div id="info">
<p>Performance Review Form for {{form.pr.employee.first_name}} {{form.pr.employee.last_name}}</p>
<p>date: {{form.pr.date}}</p>
</div>

<div id="project" class="input_div">
    <p>Please list all projects and initiatives you participated in during this performance review period.</p>
    {% for project in form.projects %}
        <p class='text_field' onclick="make_input(this)" id="{{project.key}}">{{project.value}}</p>
    {% endfor %}
    <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}')" value="add" >
</div>

<div id="prev_achievements">
    <a href="#" onclick="display(this)">Previous achievements</a>
    <div class='hidden'>
        {% for achievement in prev_pr.achievements %}
            <p>{{achievement.value}}</p>
        {% endfor %}
    </div>
</div>

<div id="achievements" class="input_div">
    <p>What do you consider to be your key accomplishments since your last review?</p>
    {% for ach in form.achievements %}
        <p class='text_field' onclick="make_input(this)" id="{{ach.key}}">{{ach.value}}</p>
    {% endfor %}
    <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}')" value="add" >
</div>

<div id="responsibility" class="input_div">
    <p>List your key job responsibilities during your performance period. Please comment on your job performance assessment.</p>
    {% for responsibility in form.responsibilities %}
        <p class='text_field' onclick="make_input(this)" id="{{responsibility.key}}">{{responsibility.value}}</p>
    {% endfor %}
    <input type="button" class="add_button" onclick="add_data(this,'{{form.key}}')" value="add" >
</div>

<div id="prev_challenges">
    <a href="#" onclick="display(this)">Previous challenges</a>
    <div class='hidden'>
        {% for challenge in prev_pr.challenges %}
            <p>{{challenge.value}}</p>
        {% endfor %}
    </div>
</div>

<div id="challenges" class="input_div">
    <p>If you have experienced challenges, please specify the areas where you need to focus and improve. </p>
    {% for challenge in form.challenges %}
        <!-- todo: use css class instead of properties -->
        <p class='text_field' onclick="make_input(this)" id="{{challenge.key}}">{{challenge.value}}</p>
    {% endfor %}
    <input type="button" class="add_button" onclick="add_data(this,'{{form.key}}')" value="add" >
</div>

<div id="skill" class="input_div">
    <p>Please mention what skills and/or knowledge do you need for further development to contribute to your overall job success.</p>
    {% for skill in form.skills %}
        <!-- todo: use css class instead of properties -->
        <p class='text_field' onclick="make_input(this)" id="{{skill.key}}" >{{skill.value}}</p>
    {% endfor %}
    <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}')" value="add" >
</div>

<div id="prev_goals" class="input_div">
    <a href="#" onclick="display(this)">Previous Goals:</a>
    <div class="hidden">
    <table>
        <thead>
            <tr>
                <td>Goal</td>
                <td>Value</td>
            </tr>
        </thead>
    {% for prev_goal in prev_pr.goals %}
        <tr>
            <td>{{prev_goal.value}}</td>
            <td>
                <select id="{{prev_goal.key}}" onchange="set_result(this.id, this.options[selectedIndex].value)">
                    <option value="1" class="grade">below expectations</option>
                    <option value="2" class="grade">meet expectations</option>
                    <option value="3" class="grade">above expectations</option>
                </select>
                <script type="text/javascript" language="JavaScript">
                    $("#{{prev_goal.key}}").val("{{prev_goal.result}}");
                </script>
            </td>
        </tr>
    {% endfor %}
    </table>
    </div>
</div>

<div id="next_goals" class="input_div">
    <p>Goals for the next period:</p>
    {% for goal in form.next_goals %}
        <p class='text_field' onclick="make_input(this)" id="{{goal.key}}" >{{goal.value}}</p>
    {% endfor %}
    <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}')" value="add" >
</div>

<div id="career" class="input_div">
    <p>What are your professional interests and long-term career objectives, and what are you plans to accomplish these objectives?  </p>
    {% for career in form.careers %}
        <p class='text_field' onclick="make_input(this)" id="{{career.key}}" >{{career.value}}</p>
    {% endfor %}
    <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}')" value="add" >
</div>

<div id="issue" class="input_div">
    <p>Do you see any issues with your role within the company and/or your project(s)?</p>
    {% for issue in form.issues %}
        <p class='text_field' onclick="make_input(this)" id="{{issue.key}}" >{{issue.value}}</p>
    {% endfor %}
    <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}')" value="add" >
</div>

<div id="complaint" class="input_div">
    <p>Do you have any complaints?</p>
    {% for complaint in form.complaints %}
        <p class='text_field' onclick="make_input(this)" id="{{complaint.key}}" >{{complaint.value}}</p>
    {% endfor %}
    <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}')" value="add" >
</div>

<div id="manager_help" class="input_div">
    <p>Is there anything your manager could do to help you do a better job? </p>
    {% for manager_help in form.manager_helps %}
        <p class='text_field' onclick="make_input(this)" id="{{manager_help.key}}" >{{manager_help.value}}</p>
    {% endfor %}
    <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}')" value="add" >
</div>

<div id='salary' class="input_div">
    <p>Salary:</p>
        {% if form.get_all_data.salary %}
            <p class='text_field' onclick="make_input(this)" id="{{form.get_all_data.salary.key}}" >{{form.get_all_data.salary.value}}</p>
        {% else %}
            <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}'); $(this).css('display','none')" value="add" >
        {% endif %}
</div>

<div id='grade' class="input_div">
    <p>Grade:</p>
    {% if form.get_all_data.grade %}
        <p class='text_field' onclick="make_input(this)" id="{{form.get_all_data.grade.key}}" >{{form.get_all_data.grade.value}}</p>
    {% else %}
        <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}'); $(this).css('display','none')" value="add" >
    {% endif %}
</div>

<div id='position' class="input_div">
    <p>Current Position: {{form.pr.employee.position}}</p>
    <p>New position:</p>
    {% if form.get_all_data.position %}
        <p class='text_field' onclick="make_input(this)" id="{{form.get_all_data.position.key}}" >{{form.get_all_data.position.value}}</p>
    {% else %}
        <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}'); $(this).css('display','none')" value="add" >
    {% endif %}
</div>

<div id='conclusion' class="input_div">
    <p>Conclusion:</p>
    {% if form.get_all_data.conclusion %}
        <p class='text_field' onclick="make_input(this)" id="{{form.get_all_data.conclusion.key}}" >{{form.get_all_data.conclusion.value}}</p>
    {% else %}
        <input type="button" class="add_button" onclick="add_data(this, '{{form.key}}'); $(this).css('display','none')" value="add" >
    {% endif %}
</div>

<div id="file">
    <p>Attached files:</p>
    {% if file_name%}
        <a href="/serve/{{file_key}}">{{file_name}}</a>
    {% endif %}
</div>

<div>
    <form action="{{upload_url}}" method="POST" enctype="multipart/form-data">
        <input type='hidden' name='key' value={{key}}>
        <input type="file" name="file"><br>
        <input type="submit" name="submit" value="attach">
    </form>
</div>

<div>
    {% ifequal form.status 'draft' %}
        <input type="button" id='submit' onclick="submit()" value="submit">
    {% else %}
        <input type="button" id='approve' onclick="check_form()" value="approve">
    {% endifequal %}
</div>
{% endblock %}